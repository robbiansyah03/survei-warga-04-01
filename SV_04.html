<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Form Survei RT 04 RW.01</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  .invalid { border-color: red !important; box-shadow: 0 0 5px red; }
</style>
</head>
<body class="bg-gradient-to-b from-blue-50 to-blue-100 min-h-screen flex flex-col items-center p-4">

<div class="bg-white shadow-lg rounded-xl p-6 w-full max-w-md mt-6 mb-6">
  <h2 class="text-2xl font-bold mb-2 text-center text-blue-900">Survei Warga RT 04 RW.01</h2>
  <p class="text-gray-700 text-center mb-6">Form survei bersifat anonim, digunakan untuk evaluasi lingkungan RT.</p>

  <form id="surveyForm">
    <!-- 0. RT dan RW -->
    <div class="mb-4">
      <label class="block mb-1 font-semibold">RT Anda:</label>
      <select name="rt" class="w-full border rounded p-2" required>
        <option value="">-- Pilih --</option>
        <option>03</option>
        <option>04</option>
        
      </select>
    </div>

    <div class="mb-4">
      <label class="block mb-1 font-semibold">RW Anda:</label>
      <select name="rw" class="w-full border rounded p-2" required>
        <option value="">-- Pilih --</option>
        <option>01</option>
        
      </select>
    </div>

    <!-- 1. Kode unik -->
    <div class="mb-4">
      <label class="block mb-1 font-semibold">Kode unik rumah tangga:</label>
      <input type="text" name="kode_unik" class="w-full border rounded p-2" placeholder="Masukkan kode unik" required>
      <p class="text-sm text-gray-500 mt-1">Kode ini diberikan oleh RT/RW untuk validasi warga.</p>
    </div>

    <!-- 2. Kinerja Ketua RT -->
    <div class="mb-4">
      <label class="block mb-1 font-semibold">1. Penilaian Kinerja Ketua RT:</label>
      <select name="kinerja" class="w-full border rounded p-2" required>
        <option value="">-- Pilih --</option>
        <option>Sangat Puas</option>
        <option>Puas</option>
        <option>Cukup</option>
        <option>Kurang</option>
        <option>Sangat Kurang</option>
      </select>
    </div>

    <!-- 3. Harapan RT -->
    <div class="mb-4">
      <label class="block mb-1 font-semibold">2. Harapan Anda terhadap RT ke depan:</label>
      <select name="harapan" class="w-full border rounded p-2" required>
        <option value="">-- Pilih --</option>
        <option>Keamanan lingkungan</option>
        <option>Kebersihan lingkungan</option>
        <option>Program kegiatan warga</option>
        <option>Komunikasi yang lebih baik</option>
        <option>Lainnya</option>
      </select>
      <textarea name="harapan_lain" rows="2" class="w-full border rounded p-2 mt-2" placeholder="Harapan lain yang spesifik"></textarea>
    </div>

    <!-- 4. Masukan -->
    <div class="mb-4">
      <label class="block mb-1 font-semibold">3. Masukan untuk Ketua RT:</label>
      <textarea name="masukan_ketua" rows="4" class="w-full border rounded p-2" placeholder="Tulis masukan Anda" required></textarea>
    </div>

    <!-- 5. Calon Ketua RT -->
    <div class="mb-4">
      <label class="block mb-1 font-semibold">4. Nama Ketua RT baru yang diusulkan:</label>
      <input type="text" name="rekomendasi_rt" class="w-full border rounded p-2" placeholder="Nama Ketua RT baru" required>
    </div>

    <div class="mb-4">
      <label class="block mb-1 font-semibold">Alasan usulan Ketua RT:</label>
      <textarea name="alasan_usulan" rows="3" class="w-full border rounded p-2" placeholder="Alasan Anda memilih calon ini" required></textarea>
    </div>

    <div class="flex flex-col space-y-2">
      <button type="button" onclick="window.history.back()" class="bg-gray-500 text-white py-2 px-4 rounded hover:bg-gray-600">Kembali</button>
      <button type="button" onclick="kirimSurvey()" class="bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700 font-bold">Kirim Survei</button>
    </div>
  </form>
</div>

<script>
const daftarKodeValid = ['RT04RW01-001','RT04RW01-002','RT04RW01-003']; // Contoh kode unik yang valid

function kirimSurvey() {
  if (localStorage.getItem('surveySent')) {
    alert("Anda sudah mengirim survei sebelumnya.");
    return;
  }

  const form = document.getElementById('surveyForm');
  let valid = true;
  const fields = form.querySelectorAll('select[required], textarea[required], input[required]');

  fields.forEach(f => {
    if (!f.value) {
      f.classList.add('invalid');
      valid = false;
    } else {
      f.classList.remove('invalid');
    }
  });

  if (!valid) {
    alert("Isi semua pertanyaan sebelum mengirim.");
    return;
  }

  // Validasi kode unik
  const kode = form.kode_unik.value.trim();
  if (!daftarKodeValid.includes(kode)) {
    alert("Kode unik tidak valid atau sudah digunakan.");
    return;
  }

  // Ambil data survei
  const rt = form.rt.value;
  const rw = form.rw.value;
  const kinerja = form.kinerja.value;
  const harapan = form.harapan.value;
  const harapanLain = form.harapan_lain.value;
  const masukan = form.masukan_ketua.value;
  const rekomendasi = form.rekomendasi_rt.value;
  const alasan = form.alasan_usulan.value;

  // Buat pesan WA
  let message = `Survei Warga RT ${rt} RW ${rw}:\n`;
  message += `1. Kinerja Ketua RT: ${kinerja}\n`;
  message += `2. Harapan: ${harapan} ${harapanLain ? '- '+harapanLain : ''}\n`;
  message += `3. Masukan: ${masukan}\n`;
  message += `4. Calon Ketua RT: ${rekomendasi}\n`;
  message += `   Alasan: ${alasan}`;

  const waURL = `https://wa.me/6281113805742?text=${encodeURIComponent(message)}`;
  localStorage.setItem('surveySent', 'true'); // tandai sudah kirim
  // Hapus kode dari daftar agar tidak bisa digunakan lagi
  const index = daftarKodeValid.indexOf(kode);
  if (index > -1) daftarKodeValid.splice(index, 1);

  window.open(waURL, '_blank');
}
</script>

</body>
</html>
